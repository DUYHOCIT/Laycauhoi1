<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lấy câu hỏi</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #8e9eab, #eef2f3);
            color: #333;
            animation: fadeIn 1.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            animation: slideUp 1s ease-in-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        h1 {
            text-align: center;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .instructions {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            line-height: 1.6;
            font-size: 16px;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            resize: none;
            transition: box-shadow 0.3s;
        }

        textarea:focus {
            box-shadow: 0 0 8px rgba(0, 150, 136, 0.5);
            border-color: #009688;
        }

        button {
            display: block;
            width: 100%;
            padding: 12px;
            font-size: 18px;
            background: linear-gradient(to right, #43cea2, #185a9d);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        #addJsonButton {
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
        }

        .json-group {
            position: relative;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease-in-out;
        }

        .deleteButton {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff4b5c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .deleteButton:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background: #ff1e2d;
        }

        .json-group {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.8s ease-in-out;
            background: #f9f9f9;
        }

        footer {
            text-align: center;
            margin-top: 20px;
            color: #555;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lấy câu hỏi</h1>

        <div class="instructions">
            <p><strong>Hướng dẫn sử dụng:</strong></p>
            <ol>
                <li>Bấm ctr + shift + i.</li>
                <li>Đăng nhập vào lms.</li>
                <li>Bắt đầu làm bài cần lấy câu hỏi.</li>
                <li>Chọn tab Network(Mạng).</li>
                <li>Tìm và bấm vào class-plan-activity-student-tests.</li>
                <li>Chuột phải chọn Copy và sau đó chọn Copy response.</li>
                <li>Dán dữ liệu vào khung nhập bên dưới(Bạn có thể làm test nhiều lần và thêm khung để nhập sau đó web sẽ lọc được các câu trùng đi).</li>
                <li>Nhấn nút <strong>"Thêm khung nhập JSON"</strong> nếu bạn muốn nhập thêm dữ liệu JSON khác.</li>
                <li>Nhấn nút <strong>"Xử lý"</strong> để chuyển đổi dữ liệu và hiển thị kết quả.</li>
                <li>Nếu bạn thêm nhầm khung nhập, hãy nhấn nút <strong>"×"</strong> ở góc phải để xóa khung đó.</li>
                
            </ol>
            <p><strong>LƯU Ý: CHỈ SỬ DỤNG CÁCH NÀY KHI ĐÃ LÀM HẾT 3 LẦN</strong></p>
        </div>

        <button id="videoGuideButton">Xem Hướng Dẫn Video</button>

        <div id="jsonInputs">
            <div class="json-group">
                <textarea class="jsonInput" placeholder="Dán vào đây ní ơi..."></textarea>
                <button class="deleteButton">&times;</button>
            </div>
        </div>

        <button id="addJsonButton">Thêm khung nhập dữ liệu lần test nữa</button>
        <button id="processButton">Xử lý</button>
    </div>

    <footer>
        Không share cho ai nhé
    </footer>

    <script>
        document.getElementById('addJsonButton').addEventListener('click', function () {
            const jsonInputs = document.getElementById('jsonInputs');
            const newJsonGroup = document.createElement('div');
            newJsonGroup.className = 'json-group';
            newJsonGroup.innerHTML = `
                <textarea class="jsonInput" placeholder="Dán vào đây ní ơi..."></textarea>
                <button class="deleteButton">&times;</button>
            `;
            jsonInputs.appendChild(newJsonGroup);

            const deleteButton = newJsonGroup.querySelector('.deleteButton');
            deleteButton.addEventListener('click', function () {
                jsonInputs.removeChild(newJsonGroup);
            });
        });

        document.getElementById('processButton').addEventListener('click', function () {
            const jsonInputs = document.querySelectorAll('.jsonInput');
            const uniqueQuestions = new Map();

            jsonInputs.forEach(input => {
                const jsonInput = input.value;

                if (!jsonInput.trim()) return;

                try {
                    const data = JSON.parse(jsonInput);

                    data.data.forEach(record => {
                        record.test.forEach(test => {
                            const questionId = test.id;

                            // Nếu ID câu hỏi chưa được thêm, thêm vào
                            if (!uniqueQuestions.has(questionId)) {
                                uniqueQuestions.set(questionId, {
                                    questionHtml: test.question_direction,
                                    answerOptions: test.answer_option
                                });
                            }
                        });
                    });
                } catch (error) {
                    alert('Một trong các dữ liệu JSON không hợp lệ. Vui lòng kiểm tra lại.');
                    throw error;
                }
            });

            let htmlContent = '<html><head><title>Kết quả xử lý JSON</title></head><body>';
            htmlContent += '<h1>Câu hỏi</h1>\n';

            uniqueQuestions.forEach((value, questionId) => {
                const questionHtml = value.questionHtml;
                const answerOptions = value.answerOptions;

                // Thêm câu hỏi
                htmlContent += `<h2>Câu ${questionId}</h2>\n`;
                htmlContent += `<p>${questionHtml}</p>\n`;

                // Thêm đáp án
                htmlContent += '<ul>\n';
                answerOptions.forEach(option => {
                    htmlContent += `<li>${option.value}</li>\n`;
                });
                htmlContent += '</ul>\n';
            });

            htmlContent += '</body></html>';

            // Mở kết quả trong cửa sổ mới
            const newWindow = window.open();
            newWindow.document.open();
            newWindow.document.write(htmlContent);
            newWindow.document.close();
        });

        // Xóa khung nhập JSON
        document.querySelectorAll('.deleteButton').forEach(button => {
            button.addEventListener('click', function () {
                const jsonGroup = button.parentElement;
                jsonGroup.parentElement.removeChild(jsonGroup);
            });
        });

        // Mở video hướng dẫn khi nhấn nút
        document.getElementById('videoGuideButton').addEventListener('click', function () {
            window.open('https://link-to-your-video.com', '_blank');
        });
    </script>
</body>
</html>
